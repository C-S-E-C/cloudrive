<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Cloudrive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://c-s-e-c.github.io/emojipedia/id.css">
    <style>
        .modal-active { display: flex !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

    <nav class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">C</div>
                <h1 class="text-xl font-bold text-gray-800">Cloudrive</h1>
            </div>
            <div class="flex items-center gap-4">
                <span id="userNameDisplay" class="text-sm font-medium text-gray-600"></span>
                <button onclick="logout()" class="text-sm text-red-500 hover:bg-red-50 px-3 py-1 rounded-md transition">Logout</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-8">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Quick Create</h3>
                <div class="flex gap-2">
                    <input type="text" id="newFileName" placeholder="notes.txt" autocomplete="off"
                           class="flex-1 px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="createFileWindow(document.getElementById('newFileName').value)" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">Create File</button>
                    <button onclick="createFile(document.getElementById('newFileName').value+'/',null)" 
                            class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">Create Folder</button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Storage Status</h3>
                    <div class="flex items-baseline">
                        <p class="text-2xl font-bold text-gray-800" id="SizeDisplay"></p>
                        <p class="text-1xl font-bold text-gray-500 ml-1" id="MaxSizeDisplay"></p>
                    </div>
                </div>
                <button onclick="openShareModal()" 
                        class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition shadow-lg shadow-purple-100 font-medium">
                    Share Selected
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-4 border-b border-gray-50 bg-gray-50/50 flex justify-between items-center">
                <h2 class="font-bold text-gray-700">My Files</h2>
                <div id="tools" class="flex justify-between items-center" style="width: 10%;">
                    <h2 class="text-gray-600 csecicon-home3" alt="home" onclick="document.location.href='dashboard.html'" ></h2>
                    <h2 class="text-gray-600 csecicon-folder-upload" alt="parent dir" onclick="parentdir()" ></h2>
                    <h2 class="text-gray-600 csecicon-square-full" alt="rickroll" onclick="document.location.href='https://ianchzhu.github.io/vfdstorage/nggyu.html'" ></h2>
                </div>
                <h3 class="font-bold text-gray-400" id="path"></h2>
                <button onclick="loadFiles()" class="text-blue-600 text-sm hover:underline">Refresh</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="text-gray-400 text-xs uppercase">
                            <th class="p-4 w-12"><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>
                            <th class="p-4">Name</th>
                            <th class="p-4 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="fileList" class="text-gray-600 text-sm">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="mt-12">
            <h2 class="font-bold text-gray-700 mb-4">Access Shared Storage</h2>
            <div class="bg-blue-50 border border-blue-100 p-4 rounded-lg flex justify-between items-center">
                <p class="text-blue-800 text-sm">Need to view a link shared with you?</p>
                <a href="shared_files.html" class="text-blue-700 font-bold hover:underline">Open Shared Portal &rarr;</a>
            </div>
        </div>
    </main>

    <div id="shareModal" class="hidden fixed inset-0 bg-gray-900/60 backdrop-blur-sm z-50 items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-800">Create Share Link</h3>
                <p class="text-gray-500 text-sm mt-1">Configure security for selected files</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-gray-400 uppercase mb-1">Passphrase</label>
                    <input type="password" id="sharePass" placeholder="Enter a password" autocomplete="off"
                           class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-400 uppercase mb-1">Expires After</label>
                    <select id="shareExpiry" class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none bg-white">
                        <option value="3600">1 Hour</option>
                        <option value="86400" selected>24 Hours</option>
                        <option value="604800">7 Days</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-3 mt-8">
                <button onclick="closeShareModal()" class="flex-1 py-3 text-gray-500 font-medium hover:bg-gray-50 rounded-xl transition">Cancel</button>
                <button onclick="confirmShare()" class="flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition">Generate Link</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Check Auth
        if (!localStorage.getItem('userid')) window.location.href = 'login.html';

        function toggleSelectAll() {
            const master = document.getElementById('selectAll');
            const checks = document.querySelectorAll('.file-checkbox');
            checks.forEach(c => c.checked = master.checked);
        }
    </script>
</body>
</html>
